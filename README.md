# spring-state-machine-demo

```
┌─────────────────────────────────────────────────────────────┐
│                    СХЕМА СОСТОЯНИЙ ПОЛИСА                   │
└─────────────────────────────────────────────────────────────┘

    ┌─────────────┐
    │   Создание  │
    │   полиса    │
    └──────┬──────┘
           │
           ▼
    ┌─────────────┐    Успех (70%)    ┌─────────────┐
    │  STATE1     │ ────────────────► │  STATE2     │
    │(ожидание    │                   │(ожидание    │
    │ обработки)  │ ◄──────────────── │ обработки)  │
    └─────────────┘    Провал (30%)   └─────────────┘
           │                              │
           │ Успех (70%)                  │ Успех (70%)
           ▼                              ▼
    ┌─────────────┐                   ┌─────────────┐
    │  STATE1     │                   │  STATE3     │
    │(повторная   │                   │(финальное   │
    │ обработка)  │                   │ состояние)  │
    └─────────────┘                   └─────────────┘


┌─────────────────────────────────────────────────────────────┐
│                      ЭНДПОИНТЫ                              │
└─────────────────────────────────────────────────────────────┘

POST /policies/create        - Создает полис в STATE1
GET  /policies               - Показывает все полисы и их состояния
POST /policies/process1to2   - Обрабатывает все полисы из STATE1 → STATE2
POST /policies/process2to3   - Обрабатывает все полисы из STATE2 → STATE3


┌─────────────────────────────────────────────────────────────┐
│                   ПОТОК ОБРАБОТКИ ПОЛИСА                    │
└─────────────────────────────────────────────────────────────┘

[Создание]
│
▼
[STATE1] ───► [process1to2] ────► [STATE2] ───► [process2to3] ───► [STATE3]
│                               │
│         Неудача (30%)         │         Неудача (30%)
└───────────────────────────────┘         (нужен повторный process2to3) 
                                           

```

# Создать новый полис
```bash
curl -X POST http://localhost:8080/policies/create
```

# Получить список всех полисов и их состояний
```bash
curl -X GET http://localhost:8080/policies
```

# Обработать все полисы из Состояния1 в Состояние2
```bash
curl -X POST http://localhost:8080/policies/process1to2
```

# Обработать все полисы из Состояния2 в Состояние3
```bash
curl -X POST http://localhost:8080/policies/process2to3
```
