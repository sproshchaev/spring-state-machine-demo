# spring-state-machine-demo

```declarative
✅ Преимущества использования Spring State Machine:
1. Декларативность - состояния и переходы описываются конфигурационно
2. Интеграция с Spring - легко встраивается в экосистему
3. Готовые абстракции - State, Event, Action, Guard
4. Масштабируемость - легко добавлять новые состояния и переходы
5. Тестирование - встроенные возможности для тестирования машины состояний
```

```
🎯 Основные понятия Spring State Machine
1. State (Состояние)
State - это дискретное условие, в котором находится система (в нашем случае - Полис) в определенный момент времени.
public enum PolicyState {
    STATE1,     // Начальное состояние
    STATE2,     // Промежуточное состояние  
    STATE3      // Финальное состояние
}

Пример:
STATE1: "Ожидает обработки этапа 1"
STATE2: "Обработан этап 1, ожидает этап 2"
STATE3: "Полностью обработан"

2. Event (Событие)
Event - это триггер, который инициирует переход из одного состояния в другое.
public enum PolicyEvents {
    PROCESS_TO_STATE2,    // Событие: "обработать переход в состояние 2"
    PROCESS_TO_STATE3,    // Событие: "обработать переход в состояние 3"
    RETRY                 // Событие: "повторить обработку"
}

Пример:

PROCESS_TO_STATE2: Вызывается при POST /policies/process1to2
PROCESS_TO_STATE3: Вызывается при POST /policies/process2to3
```

```
┌─────────────────────────────────────────────────────────────┐
│                    СХЕМА СОСТОЯНИЙ ПОЛИСА                   │
└─────────────────────────────────────────────────────────────┘

    ┌─────────────┐
    │   Создание  │
    │   полиса    │
    └──────┬──────┘
           │
           ▼
    ┌─────────────┐    Успех (70%)    ┌─────────────┐
    │  STATE1     │ ────────────────► │  STATE2     │
    │(ожидание    │                   │(ожидание    │
    │ обработки)  │ ◄──────────────── │ обработки)  │
    └─────────────┘    Провал (30%)   └─────────────┘
           │                              │
           │ Успех (70%)                  │ Успех (70%)
           ▼                              ▼
    ┌─────────────┐                   ┌─────────────┐
    │  STATE1     │                   │  STATE3     │
    │(повторная   │                   │(финальное   │
    │ обработка)  │                   │ состояние)  │
    └─────────────┘                   └─────────────┘


┌─────────────────────────────────────────────────────────────┐
│                      ЭНДПОИНТЫ                              │
└─────────────────────────────────────────────────────────────┘

POST /policies/create        - Создает полис в STATE1
GET  /policies               - Показывает все полисы и их состояния
POST /policies/process1to2   - Обрабатывает все полисы из STATE1 → STATE2
POST /policies/process2to3   - Обрабатывает все полисы из STATE2 → STATE3


┌─────────────────────────────────────────────────────────────┐
│                   ПОТОК ОБРАБОТКИ ПОЛИСА                    │
└─────────────────────────────────────────────────────────────┘

[Создание]
│
▼
[STATE1] ───► [process1to2] ────► [STATE2] ───► [process2to3] ───► [STATE3]
│                               │
│         Неудача (30%)         │         Неудача (30%)
└───────────────────────────────┘         (нужен повторный process2to3) 
                                           

```

# Создать новый полис
```bash
curl -X POST http://localhost:8080/policies/create
```

# Получить список всех полисов и их состояний
```bash
curl -X GET http://localhost:8080/policies
```

# Обработать все полисы из Состояния1 в Состояние2
```bash
curl -X POST http://localhost:8080/policies/process1to2
```

# Обработать все полисы из Состояния2 в Состояние3
```bash
curl -X POST http://localhost:8080/policies/process2to3
```
